

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>dbxml2rst.nodes &mdash; dbxml2rst 20160727 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="dbxml2rst 20160727 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> dbxml2rst
          

          
          </a>

          
            
            
              <div class="version">
                20160727
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Install dbxml2rst and Pandoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remarks.html">Remarks on Pandoc &amp; DocBook</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dbxml2rst/dbxml2rst.html">dbxml2rst package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dbxml2rst</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>dbxml2rst.nodes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for dbxml2rst.nodes</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8; mode: python -*-</span>
<span class="c1"># pylint: disable=C0103,C0321,R0912,R0914,R0915</span>
<span class="c1"># disable fixme-warnings:</span>
<span class="c1"># pylint: disable=W0511</span>

<span class="sa">u</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dbxml2rst.nodes</span>
<span class="sd">    ~~~~~~~~~~~~~~~</span>

<span class="sd">    Library with XML-filters to convert DocBook-XML to reST</span>

<span class="sd">    :copyright:  Copyright (C) 2017  Markus Heiser</span>
<span class="sd">    :license:    GPL V3.0, see LICENSE for details.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># imports</span>
<span class="c1"># ==============================================================================</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">html.parser</span> <span class="k">import</span> <span class="n">HTMLParser</span> <span class="c1"># pylint: disable=F0401</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="k">import</span> <span class="n">etree</span>

<span class="kn">from</span> <span class="nn">fspath</span> <span class="k">import</span> <span class="n">FSPath</span>

<span class="kn">from</span> <span class="nn">.helper</span> <span class="k">import</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">.helper</span> <span class="k">import</span> <span class="n">LOG</span>

<span class="n">INT_ENTITES</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
<span class="n">INT_ENTITES</span><span class="p">[</span><span class="s2">&quot;nbsp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot; &quot;</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;frac12&quot;</span><span class="p">,</span> <span class="s2">&quot;frac13&quot;</span><span class="p">,</span> <span class="s2">&quot;frac14&quot;</span><span class="p">,</span> <span class="s2">&quot;times&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;hellip&quot;</span><span class="p">,</span> <span class="s2">&quot;le&quot;</span><span class="p">,</span> <span class="s2">&quot;ge&quot;</span>
          <span class="p">,</span> <span class="s2">&quot;sub&quot;</span><span class="p">,</span> <span class="s2">&quot;sup&quot;</span><span class="p">,</span> <span class="s2">&quot;micro&quot;</span><span class="p">,</span> <span class="s2">&quot;plusmn&quot;</span><span class="p">,</span> <span class="s2">&quot;mdash&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="s2">&quot;ndash&quot;</span> <span class="p">]:</span>
    <span class="n">INT_ENTITES</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">HTMLParser</span><span class="p">()</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="s2">&quot;&amp;</span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="filterXML"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.filterXML">[docs]</a><span class="k">def</span> <span class="nf">filterXML</span><span class="p">(</span>
        <span class="n">folder</span><span class="p">,</span> <span class="n">inFile</span><span class="p">,</span> <span class="n">outFile</span>
        <span class="p">,</span> <span class="n">xmlFilter</span>
        <span class="p">,</span> <span class="n">parseIncludes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">,</span> <span class="n">fragTag</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ID</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Replace some xml-Markups with reST literals.&quot;&quot;&quot;</span>

    <span class="n">folder</span>    <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">outFile</span>   <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span>

    <span class="n">xmlFilter</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">outFile</span>         <span class="o">=</span> <span class="n">outFile</span>
        <span class="p">,</span> <span class="n">parseIncludes</span> <span class="o">=</span> <span class="n">parseIncludes</span> <span class="p">)</span>

    <span class="n">rootNode</span>  <span class="o">=</span> <span class="n">xmlFilter</span><span class="o">.</span><span class="n">parseFile</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">inFile</span><span class="p">,</span> <span class="n">fragTag</span><span class="o">=</span><span class="n">fragTag</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">xmlFilter</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">rootNode</span><span class="p">)</span>
    <span class="k">with</span> <span class="p">(</span><span class="n">folder</span> <span class="o">/</span> <span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">openTextFile</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="c1"># pylint: disable=E1101</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">rootNode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">)</span>
        <span class="p">)</span></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="subTemplate"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.subTemplate">[docs]</a><span class="k">def</span> <span class="nf">subTemplate</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span> <span class="n">outFile</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Substitude kenerle-doc place holder in docbook.tmpl files.&quot;&quot;&quot;</span>

    <span class="c1"># detailed description see class ReSTTemplate</span>
    <span class="n">tmpl_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^!([EIDFPC])([^\s]*)\s+(.*?)\s*$&quot;</span><span class="p">)</span>
    <span class="n">tag_format</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;rstTemplate op=&quot;</span><span class="si">%s</span><span class="s2">&quot; fname=&quot;</span><span class="si">%s</span><span class="s2">&quot; args=&quot;</span><span class="si">%s</span><span class="s2">&quot;/&gt;&quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">inFile</span><span class="o">.</span><span class="n">openTextFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">src</span><span class="p">,</span> <span class="n">outFile</span><span class="o">.</span><span class="n">openTextFile</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_lineno</span><span class="p">,</span> <span class="n">orig_line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">orig_line</span>
            <span class="k">if</span> <span class="n">tmpl_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">orig_line</span><span class="p">):</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">tmpl_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">orig_line</span><span class="p">)</span>
                <span class="n">op</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">tag_format</span> <span class="o">%</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="subEntities"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.subEntities">[docs]</a><span class="k">def</span> <span class="nf">subEntities</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span> <span class="n">outFile</span><span class="p">,</span> <span class="n">ext_entities</span><span class="p">,</span> <span class="n">int_entities</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Substitude internal and external entities.</span>

<span class="sd">    :param str folder: Root-folder where conversion takes place.</span>
<span class="sd">    :param str inFile: Preprocess XML file.</span>

<span class="sd">    :param ext_entities: container with the external entities</span>
<span class="sd">    :type ext_entities: EntityContainer or None</span>

<span class="sd">    :param int_entities: container with the internal entities</span>
<span class="sd">    :type int_entities: EntityContainer or None</span>

<span class="sd">    External entities will be replaced by a ``&lt;rstInclude fname=&#39;%s&#39;/&gt;`` tag.</span>
<span class="sd">    XMLTag.rstInclude_tag</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entity</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;&#39;&amp;(?P&lt;name&gt;[a-zA-Z][0-9a-zA-Z_-]+);&#39;&#39;&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">inFile</span><span class="o">.</span><span class="n">openTextFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">src</span><span class="p">,</span> <span class="n">outFile</span><span class="o">.</span><span class="n">openTextFile</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">orig_line</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">orig_line</span>
            <span class="c1"># FIXME: pass &quot;*&quot; as &amp;#x22C6;</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;#x22C6;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">orig_line</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">int_entities</span><span class="p">:</span>
                    <span class="n">sub</span> <span class="o">=</span> <span class="n">int_entities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sub</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;</span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ext_entities</span><span class="p">:</span>
                    <span class="n">sub</span>  <span class="o">=</span> <span class="n">ext_entities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sub</span>  <span class="o">=</span> <span class="n">ext_entities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sub</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                            <span class="s2">&quot;&amp;</span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="n">name</span>
                            <span class="p">,</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> fname=&#39;</span><span class="si">%s</span><span class="s2">&#39;/&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">XMLTag</span><span class="o">.</span><span class="n">rstInclude_tag</span><span class="p">,</span> <span class="n">sub</span><span class="p">))</span>

            <span class="c1"># internal entities within internal entities .. grrr</span>
            <span class="k">if</span> <span class="n">int_entities</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                    <span class="n">sub</span>  <span class="o">=</span> <span class="n">int_entities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sub</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;</span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
            <span class="c1"># write to file</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>


<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="XMLTagType"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTagType">[docs]</a><span class="k">class</span> <span class="nc">XMLTagType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">typeList</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">undifined</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">mcs</span><span class="o">.</span><span class="n">undifined</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;XMLTag&quot;</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">mcs</span><span class="o">.</span><span class="n">undifined</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">namespace</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

        <span class="c1"># tag = None --&gt;  marks intermediate classes</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mcs</span><span class="o">.</span><span class="n">typeList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">mcs</span><span class="o">.</span><span class="n">undifined</span><span class="p">)</span> <span class="o">!=</span> <span class="n">mcs</span><span class="o">.</span><span class="n">undifined</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;tag &lt;</span><span class="si">%s</span><span class="s2">&gt; allready defined in class </span><span class="si">%r</span><span class="s2">&quot;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">mcs</span><span class="o">.</span><span class="n">typeList</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">tag</span><span class="p">]))</span>
            <span class="n">mcs</span><span class="o">.</span><span class="n">typeList</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>

        <span class="k">return</span> <span class="bp">cls</span>

<div class="viewcode-block" id="XMLTagType.getClassByTag"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTagType.getClassByTag">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getClassByTag</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">tagName</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mcs</span><span class="o">.</span><span class="n">typeList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tagName</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="XMLTagType.getTagInstance"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTagType.getTagInstance">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getTagInstance</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">parseData</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Returns a XMLTag instance which fits to the tag or ``None``.&quot;&quot;&quot;</span>
        <span class="n">xmlTag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">TagCls</span> <span class="o">=</span> <span class="n">mcs</span><span class="o">.</span><span class="n">getClassByTag</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">TagCls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xmlTag</span> <span class="o">=</span> <span class="n">TagCls</span><span class="p">()</span>
            <span class="n">xmlTag</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parseData</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xmlTag</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="XMLTag"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag">[docs]</a><span class="k">class</span> <span class="nc">XMLTag</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">XMLTagType</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># some metadata about the parsing process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parseData</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span>
            <span class="c1"># customers hooks to call first on every node</span>
            <span class="n">hooks</span>           <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># folder where the xml-file is located</span>
            <span class="p">,</span> <span class="n">folder</span>        <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># relativ pathname of the xml-file (relative to self.folder)</span>
            <span class="p">,</span> <span class="n">fname</span>         <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># rstInclude requires the outFile from it&#39;s parent, to guess the</span>
            <span class="c1"># filesuffix for the ouptut of the include files.</span>
            <span class="p">,</span> <span class="n">parseIncludes</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="p">,</span> <span class="n">outFile</span>       <span class="o">=</span> <span class="kc">None</span>
            <span class="p">)</span>

<div class="viewcode-block" id="XMLTag.walk"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.walk">[docs]</a>    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Walks through the node-tree and applies matching filters on each node.&quot;&quot;&quot;</span>

        <span class="c1"># First, call the hooks. Hooks might build a complete new subtree, they</span>
        <span class="c1"># have to return the node to walk on and this node might have a differnt</span>
        <span class="c1"># tag type!</span>

        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;hook </span><span class="si">%r</span><span class="s2"> doesn&#39;t return a xml node!&#39;&quot;</span> <span class="o">%</span> <span class="n">func</span><span class="p">)</span>

        <span class="n">xmlTag</span> <span class="o">=</span> <span class="n">XMLTagType</span><span class="o">.</span><span class="n">getTagInstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xmlTag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xmlTag</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmlTag</span><span class="o">.</span><span class="n">breakFlag</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">walkChilds</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstBlock</span><span class="p">)</span></div>

<div class="viewcode-block" id="XMLTag.walkChilds"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.walkChilds">[docs]</a>    <span class="k">def</span> <span class="nf">walkChilds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span></div>

<div class="viewcode-block" id="XMLTag.parseFile"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.parseFile">[docs]</a>    <span class="k">def</span> <span class="nf">parseFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">fragTag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Tries to parse the XML file with :py:mod:`lxml.etree`.</span>

<span class="sd">        A unknown entity within a xml (fragment) will cause an exception. In</span>
<span class="sd">        this case, run :py:func:`subEntities` first!&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="c1"># folder where the xml-file is located</span>
            <span class="n">folder</span>   <span class="o">=</span> <span class="n">folder</span>
            <span class="c1"># relativ pathname of the xml-file (relative to self.folder)</span>
            <span class="p">,</span> <span class="n">fname</span>  <span class="o">=</span> <span class="n">fname</span>
            <span class="p">)</span>

        <span class="n">preTag</span>  <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">postTag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fragTag</span><span class="p">:</span>
            <span class="n">preTag</span>  <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;&lt;</span><span class="si">%s%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fragTag</span><span class="p">,</span> <span class="s1">&#39; id=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">ID</span> <span class="k">if</span> <span class="n">ID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">postTag</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;&lt;/</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="n">fragTag</span>

        <span class="n">fname</span>    <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="n">folder</span> <span class="o">/</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">xmlFlag</span>  <span class="o">=</span> <span class="kc">False</span>
        <span class="n">rootNode</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">fname</span><span class="o">.</span><span class="n">openTextFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;?xml&quot;</span><span class="p">):</span>
                <span class="n">xmlFlag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">xmlFlag</span><span class="p">:</span>
            <span class="n">rootNode</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span> <span class="c1"># pylint: disable=E1101</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">readFile</span><span class="p">()</span>
            <span class="n">rootNode</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span> <span class="c1"># pylint: disable=E1101</span>
                <span class="sa">u</span><span class="s2">&quot;&lt;dummy&gt;&quot;</span>
                <span class="o">+</span> <span class="n">preTag</span>
                <span class="o">+</span> <span class="n">content</span>
                <span class="o">+</span> <span class="n">postTag</span>
                <span class="o">+</span> <span class="sa">u</span><span class="s2">&quot;&lt;/dummy&gt;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rootNode</span></div>


<div class="viewcode-block" id="XMLTag.insertAsRawHTML"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.insertAsRawHTML">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">insertAsRawHTML</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">literal</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;unicode&quot;</span><span class="p">)</span> <span class="c1"># pylint: disable=E1101</span>
        <span class="n">literal</span> <span class="o">=</span> <span class="n">literal</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">literal</span> <span class="o">=</span> <span class="n">literal</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. raw:: html</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">blockText</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">literal</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">getInjBlockTag</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">raw</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">replaceNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span></div>

<div class="viewcode-block" id="XMLTag.chunkNode"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.chunkNode">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">chunkNode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="c1"># break recursion, from the caller</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunkNode&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;chunkNode&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">fname</span>  <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">inclTag</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">makeelement</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstInclude_tag</span><span class="p">)</span>
        <span class="n">inclTag</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;fname&quot;</span><span class="p">,</span> <span class="n">fname</span><span class="o">.</span><span class="n">suffix</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">))</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;INFO: create chunk </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">inclTag</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;unicode&quot;</span><span class="p">)))</span> <span class="c1"># pylint: disable=E1101</span>
        <span class="k">with</span> <span class="p">(</span><span class="n">folder</span> <span class="o">/</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">openTextFile</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="c1"># pylint: disable=E1101</span>
                <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">replaceNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">inclTag</span><span class="p">)</span></div>

    <span class="c1"># ---------------</span>
    <span class="c1"># nodes</span>
    <span class="c1"># ---------------</span>

<div class="viewcode-block" id="XMLTag.copyNode"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.copyNode">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">copyNode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">moveID</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">tag</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">makeelement</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span>
        <span class="n">new</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">tail</span>
        <span class="n">new</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">moveID</span><span class="p">:</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="n">new</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="XMLTag.dropNode"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.dropNode">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">dropNode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;node </span><span class="si">%s</span><span class="s2"> is the root node / can&#39;t droped&quot;</span> <span class="o">%</span> <span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="XMLTag.replaceNode"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.replaceNode">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">replaceNode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">oldNode</span><span class="p">,</span> <span class="n">newNode</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">oldNode</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">oldNode</span><span class="p">,</span> <span class="n">newNode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;node </span><span class="si">%s</span><span class="s2"> is the root node / can&#39;t replaced&quot;</span> <span class="o">%</span> <span class="n">oldNode</span><span class="p">)</span></div>


    <span class="c1"># The &lt;programlisting&gt; content will be passed through *as is* by pandoc</span>
    <span class="c1"># DocBook reader and can be handled in the pandoc filter.</span>

    <span class="n">rstInjection_sig</span> <span class="o">=</span> <span class="s2">&quot;!ri!&quot;</span>

<div class="viewcode-block" id="XMLTag.pandocFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.pandocFilter">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">pandocFilter</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span> <span class="c1"># pylint: disable=W0613</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;CodeBlock&#39;</span><span class="p">:</span>

            <span class="c1"># DocBook injection --&gt; &quot;programlisting&quot;</span>
            <span class="c1"># --------------------------------------</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">txt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstInjection_sig</span><span class="p">):</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">txt</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstInjection_sig</span><span class="p">):]</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="s1">&#39;Plain&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="s1">&#39;Str&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">new</span><span class="p">}]}</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;Code&#39;</span><span class="p">:</span>

            <span class="c1"># DocBook injection --&gt; &quot;code&quot;</span>
            <span class="c1"># --------------------------------------</span>

            <span class="n">txt</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">txt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstInjection_sig</span><span class="p">):</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">txt</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstInjection_sig</span><span class="p">):]</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="s1">&#39;Str&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">new</span><span class="p">}</span></div>

<div class="viewcode-block" id="XMLTag.getInjInlineTag"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.getInjInlineTag">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getInjInlineTag</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># pylint: disable=E1101</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>            <span class="c1"># pandoc --&gt; &quot;CodeBlock&quot;</span>
        <span class="n">new</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">rstInjection_sig</span>
        <span class="n">new</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rstInjection&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="XMLTag.getInjBlockTag"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.getInjBlockTag">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getInjBlockTag</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># pylint: disable=E1101</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;programlisting&quot;</span><span class="p">)</span>  <span class="c1"># pandoc --&gt; &quot;Code&quot;</span>
        <span class="n">new</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">rstInjection_sig</span>
        <span class="n">new</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rstInjection&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="XMLTag.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropFlag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># injection is done as pandoc &quot;Code&quot; or &quot;CodeBlock&quot;</span>
        <span class="k">def</span> <span class="nf">getInjTag</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">injBlock</span><span class="p">:</span>  <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInjBlockTag</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>              <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInjInlineTag</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">new</span>

        <span class="n">preText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preText</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">preText</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">getInjTag</span><span class="p">()</span>
            <span class="n">new</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">preText</span>
            <span class="n">node</span><span class="o">.</span><span class="n">addprevious</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>

        <span class="n">postText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postText</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">postText</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">getInjTag</span><span class="p">()</span>
            <span class="n">new</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">postText</span>
            <span class="n">node</span><span class="o">.</span><span class="n">addnext</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>

        <span class="n">replaceText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceText</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">replaceText</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">getInjTag</span><span class="p">()</span>
            <span class="n">new</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">replaceText</span>
            <span class="n">new</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">tail</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replaceNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span></div>

    <span class="c1"># ---------------</span>
    <span class="c1"># reST</span>
    <span class="c1"># ---------------</span>

    <span class="n">rstInclude_tag</span>  <span class="o">=</span> <span class="s2">&quot;rstInclude&quot;</span>
    <span class="n">rstTemplate_tag</span> <span class="o">=</span> <span class="s2">&quot;rstTemplate&quot;</span>

<div class="viewcode-block" id="XMLTag.normalizeID"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.normalizeID">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">normalizeID</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ID</span><span class="p">):</span>
        <span class="c1"># not needed, may be later</span>
        <span class="c1">#if ID is not None:</span>
        <span class="c1">#    ID = ID.replace(&quot;-&quot;,&quot;_&quot;)</span>
        <span class="k">return</span> <span class="n">ID</span></div>

<div class="viewcode-block" id="XMLTag.getText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.getText">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getText</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">nodelist</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;The text *as is* from ``node.itertext()``&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="n">txt</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">itertext</span><span class="p">()])</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">return</span> <span class="n">retVal</span></div>

<div class="viewcode-block" id="XMLTag.getStripedText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.getStripedText">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getStripedText</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">nodelist</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;The text from node.itertext() with reduced whitespaces&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="o">*</span><span class="n">nodelist</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="XMLTag.getFormatedTitle"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.getFormatedTitle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getFormatedTitle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">from_tag</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;title as one line, prefixed with py:attribute:`rstBlock`&quot;&quot;&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">title_node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">from_tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">rstBlock</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">title_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">title</span></div>

<div class="viewcode-block" id="XMLTag.blockText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.blockText">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">blockText</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Adds ``prefix`` to lines from ``text``, deletes trailing whitespaces&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">retVal</span> <span class="o">+=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span>
            <span class="n">retVal</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">retVal</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span></div>

    <span class="c1"># ---------------</span>
    <span class="c1"># Subclassing API</span>
    <span class="c1"># ---------------</span>

    <span class="c1"># xml tag-name e.g &quot;section&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">XMLTagType</span><span class="o">.</span><span class="n">undifined</span>

    <span class="c1"># inject rst as inline or as block</span>
    <span class="n">injBlock</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Tag-Filter breaks XML recursion</span>
    <span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Tag should be droped</span>
    <span class="n">dropFlag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># additional prefix for lines within *this* rst-Block</span>
    <span class="n">rstBlock</span>  <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">rstAnchor</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. _</span><span class="si">%(ID)s</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">rstMarkup</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># pylint: disable=W0613</span>

<div class="viewcode-block" id="XMLTag.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeID</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="XMLTag.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span> <span class="c1"># pylint: disable=R0201</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="XMLTag.preText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.preText">[docs]</a>    <span class="k">def</span> <span class="nf">preText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>     <span class="c1"># pylint: disable=R0201</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="XMLTag.postText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.XMLTag.postText">[docs]</a>    <span class="k">def</span> <span class="nf">postText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>    <span class="c1"># pylint: disable=R0201</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>


<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="LinkTag"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.LinkTag">[docs]</a><span class="k">class</span> <span class="nc">LinkTag</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">rstMarkup</span> <span class="o">=</span> <span class="s2">&quot;:ref:`</span><span class="si">%(text)s</span><span class="s2"> &lt;</span><span class="si">%(linkend)s</span><span class="s2">&gt;`&quot;</span>

<div class="viewcode-block" id="LinkTag.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.LinkTag.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">linkend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeID</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linkend&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="LinkTag.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.LinkTag.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstMarkup</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;:ref:`</span><span class="si">%(linkend)s</span><span class="s2">`&quot;</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Link"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Link">[docs]</a><span class="k">class</span> <span class="nc">Link</span><span class="p">(</span><span class="n">LinkTag</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="Xref"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Xref">[docs]</a><span class="k">class</span> <span class="nc">Xref</span><span class="p">(</span><span class="n">LinkTag</span><span class="p">):</span> <span class="k">pass</span></div>
<span class="c1"># ------------------------------------------------------------------------------</span>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Ulink"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Ulink">[docs]</a><span class="k">class</span> <span class="nc">Ulink</span><span class="p">(</span><span class="n">LinkTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">rstMarkup</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">%(text)s</span><span class="s2"> &lt;</span><span class="si">%(linkend)s</span><span class="s2">&gt;`__&quot;</span>

<div class="viewcode-block" id="Ulink.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Ulink.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">linkend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeID</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Ulink.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Ulink.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstMarkup</span>
        <span class="c1"># FIXME: droped ref-text, because it is (mostly) redundant and long refs</span>
        <span class="c1"># are killed by tables</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(linkend)s</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Constant"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Constant">[docs]</a><span class="k">class</span> <span class="nc">Constant</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="c1"># a inline literal should contain not any leading/trailing whitespace</span>

    <span class="n">replaceTag</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Constant.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Constant.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceTag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Structure tags like &lt;refsection&gt; and &lt;section&gt; are simmular</span>
            <span class="n">newNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceTag</span><span class="p">,</span> <span class="n">moveID</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replaceNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">newNode</span><span class="p">)</span>
            <span class="c1">#SDK.CONSOLE()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">newNode</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="c1"># drop empty inline literals</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dropNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rstBlock</span><span class="p">)</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Property"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Property">[docs]</a><span class="k">class</span> <span class="nc">Property</span><span class="p">(</span><span class="n">Constant</span><span class="p">):</span>      <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span></div>
<div class="viewcode-block" id="Token"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Token">[docs]</a><span class="k">class</span> <span class="nc">Token</span><span class="p">(</span><span class="n">Constant</span><span class="p">):</span>         <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span></div>
<div class="viewcode-block" id="Filename"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Filename">[docs]</a><span class="k">class</span> <span class="nc">Filename</span><span class="p">(</span><span class="n">Constant</span><span class="p">):</span>      <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span></div>
<div class="viewcode-block" id="Varname"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Varname">[docs]</a><span class="k">class</span> <span class="nc">Varname</span><span class="p">(</span><span class="n">Constant</span><span class="p">):</span>       <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span></div>
<span class="c1"># ------------------------------------------------------------------------------</span>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Subtitle"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Subtitle">[docs]</a><span class="k">class</span> <span class="nc">Subtitle</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">injBlock</span>  <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rstMarkup</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**</span><span class="si">%(title)s</span><span class="s2">**</span><span class="se">\n\n</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="Subtitle.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Subtitle.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Subtitle.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Subtitle.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstMarkup</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="StructureTag"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.StructureTag">[docs]</a><span class="k">class</span> <span class="nc">StructureTag</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">breakFlag</span>      <span class="o">=</span> <span class="kc">False</span>
    <span class="n">injBlock</span>       <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rstPreMarkup</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. _</span><span class="si">%(ID)s</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">rstTitleMarkup</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span>
    <span class="n">replaceTag</span>     <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="StructureTag.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.StructureTag.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceTag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Structure tags like &lt;refsection&gt; and &lt;section&gt; are simmular</span>
            <span class="n">newNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceTag</span><span class="p">,</span> <span class="n">moveID</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replaceNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">newNode</span><span class="p">)</span>
            <span class="c1">#SDK.CONSOLE()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">newNode</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Structure tag resets the indentation rstPrefix</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rstBlock</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTag.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.StructureTag.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFormatedTitle</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="StructureTag.rstTitle"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.StructureTag.rstTitle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">rstTitle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">title</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstTitleMarkup</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructureTag.preText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.StructureTag.preText">[docs]</a>    <span class="k">def</span> <span class="nf">preText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="c1">#SDK.CONSOLE()</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">ID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rst</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstPreMarkup</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="n">rst</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstTitle</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># drop no more needed child nodes!</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropNode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="c1">#print(&quot;%r preText --&gt;|%s|&lt;--&quot; % (node, (rst % ctx)))</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Section"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Section">[docs]</a><span class="k">class</span> <span class="nc">Section</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">rstTitleMarkup</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span>
<div class="viewcode-block" id="Section.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Section.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">sectLevel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">,]:</span>
                <span class="c1">#SDK.CONSOLE()</span>
                <span class="n">sectLevel</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rstTitleMarkup</span> <span class="o">=</span> <span class="s1">&#39;=-^&quot;+&#39;</span><span class="p">[</span><span class="n">sectLevel</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Section.rstTitle"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Section.rstTitle">[docs]</a>    <span class="k">def</span> <span class="nf">rstTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">title</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rstTitleMarkup</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Appendix"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Appendix">[docs]</a><span class="k">class</span> <span class="nc">Appendix</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>       <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;chapter&quot;</span></div>
<div class="viewcode-block" id="Bibliography"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Bibliography">[docs]</a><span class="k">class</span> <span class="nc">Bibliography</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>   <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;chapter&quot;</span></div>
<div class="viewcode-block" id="Legalnotice"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Legalnotice">[docs]</a><span class="k">class</span> <span class="nc">Legalnotice</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>    <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;section&quot;</span></div>
<div class="viewcode-block" id="Para"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Para">[docs]</a><span class="k">class</span> <span class="nc">Para</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>           <span class="k">pass</span></div>
<div class="viewcode-block" id="Sect1"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Sect1">[docs]</a><span class="k">class</span> <span class="nc">Sect1</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>          <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;section&quot;</span></div>
<div class="viewcode-block" id="Sect2"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Sect2">[docs]</a><span class="k">class</span> <span class="nc">Sect2</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>          <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;section&quot;</span></div>
<div class="viewcode-block" id="Sect3"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Sect3">[docs]</a><span class="k">class</span> <span class="nc">Sect3</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>          <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;section&quot;</span></div>
<span class="c1"># ------------------------------------------------------------------------------</span>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Part"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Part">[docs]</a><span class="k">class</span> <span class="nc">Part</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
    <span class="n">rstTitleMarkup</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>

<div class="viewcode-block" id="Part.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Part.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">partinfo</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;partinfo&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">partinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># move it to the end of the part</span>
            <span class="n">chapter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyNode</span><span class="p">(</span><span class="n">partinfo</span><span class="p">,</span> <span class="s2">&quot;chapter&quot;</span><span class="p">,</span> <span class="n">moveID</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">title</span>   <span class="o">=</span> <span class="n">partinfo</span><span class="o">.</span><span class="n">makeelement</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
            <span class="n">title</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Revision and Copyright&quot;</span>
            <span class="n">chapter</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">partinfo</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Part.rstTitle"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Part.rstTitle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">rstTitle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>   <span class="o">+</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstTitleMarkup</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">title</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstTitleMarkup</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Bookinfo"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Bookinfo">[docs]</a><span class="k">class</span> <span class="nc">Bookinfo</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span> <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;part&quot;</span></div>
<div class="viewcode-block" id="Setinfo"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Setinfo">[docs]</a><span class="k">class</span> <span class="nc">Setinfo</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span> <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;part&quot;</span></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Chapter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Chapter">[docs]</a><span class="k">class</span> <span class="nc">Chapter</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
    <span class="n">rstTitleMarkup</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>

<div class="viewcode-block" id="Chapter.rstTitle"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Chapter.rstTitle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">rstTitle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>   <span class="o">+</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstTitleMarkup</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">title</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">rstTitleMarkup</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div></div>
<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Preface"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Preface">[docs]</a><span class="k">class</span> <span class="nc">Preface</span><span class="p">(</span><span class="n">Chapter</span><span class="p">):</span> <span class="n">rstTitleMarkup</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span></div>
<span class="c1"># ------------------------------------------------------------------------------</span>


<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Refentry"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refentry">[docs]</a><span class="k">class</span> <span class="nc">Refentry</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">injBlock</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Refentry.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refentry.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="n">refentrytitle</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;refmeta/refentrytitle&quot;</span><span class="p">)</span>
        <span class="n">refname</span>       <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;refnamediv/refname&quot;</span><span class="p">)</span>

        <span class="n">ID</span> <span class="o">=</span> <span class="n">refname</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ID</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">ID</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizeID</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">refname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">refname</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">title</span>   <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">refname</span>
        <span class="k">if</span> <span class="n">refentrytitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">title</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">refentrytitle</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">manvol</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;refmeta/manvolnum&quot;</span><span class="p">))</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">refmiscinfo</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;refmeta/refmiscinfo&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Refentry.preText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refentry.preText">[docs]</a>    <span class="k">def</span> <span class="nf">preText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">ID</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstAnchor</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="n">rst</span> <span class="o">+=</span> <span class="n">Chapter</span><span class="o">.</span><span class="n">rstTitle</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">refname</span><span class="p">:</span>
            <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*man </span><span class="si">%(refname)s</span><span class="s2">(</span><span class="si">%(manvol)s</span><span class="s2">)*</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">refmiscinfo</span><span class="p">:</span>
            <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*</span><span class="si">%(refmiscinfo)s</span><span class="s2">*</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># drop no more needed child nodes!</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;refmeta/refentrytitle&quot;</span> <span class="p">,</span> <span class="s2">&quot;refmeta/manvolnum&quot;</span> <span class="p">,</span>
                   <span class="s2">&quot;refmeta/refmiscinfo&quot;</span><span class="p">,</span> <span class="s2">&quot;refnamediv/refname&quot;</span> <span class="p">]:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dropNode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>


<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Refsynopsisdiv"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refsynopsisdiv">[docs]</a><span class="k">class</span> <span class="nc">Refsynopsisdiv</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="Refsynopsisdiv.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refsynopsisdiv.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Synopsis&quot;</span>
        <span class="k">return</span> <span class="n">ctx</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Refentryinfo"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refentryinfo">[docs]</a><span class="k">class</span> <span class="nc">Refentryinfo</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="c1"># seems useless ...</span>
    <span class="c1">#</span>
    <span class="c1"># &lt;refentryinfo&gt;</span>
    <span class="c1"># &lt;title&gt;LINUX&lt;/title&gt;</span>
    <span class="c1"># &lt;productname&gt;Kernel Hackers Manual&lt;/productname&gt;</span>
    <span class="c1"># &lt;date&gt;April 2016&lt;/date&gt;</span>
    <span class="c1"># &lt;/refentryinfo&gt;</span>

    <span class="n">dropFlag</span> <span class="o">=</span> <span class="kc">True</span></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Refsection"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refsection">[docs]</a><span class="k">class</span> <span class="nc">Refsection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>          <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;section&quot;</span></div>
<div class="viewcode-block" id="Refsect1"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refsect1">[docs]</a><span class="k">class</span> <span class="nc">Refsect1</span><span class="p">(</span><span class="n">Sect1</span><span class="p">):</span>              <span class="k">pass</span></div>
<div class="viewcode-block" id="Refsect2"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refsect2">[docs]</a><span class="k">class</span> <span class="nc">Refsect2</span><span class="p">(</span><span class="n">Sect2</span><span class="p">):</span>              <span class="k">pass</span></div>
<div class="viewcode-block" id="Refsect3"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refsect3">[docs]</a><span class="k">class</span> <span class="nc">Refsect3</span><span class="p">(</span><span class="n">Sect3</span><span class="p">):</span>              <span class="k">pass</span></div>
<div class="viewcode-block" id="Refpurpose"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refpurpose">[docs]</a><span class="k">class</span> <span class="nc">Refpurpose</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>     <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;para&quot;</span></div>
<div class="viewcode-block" id="Refnamediv"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Refnamediv">[docs]</a><span class="k">class</span> <span class="nc">Refnamediv</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>     <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;section&quot;</span></div>
<span class="c1"># ------------------------------------------------------------------------------</span>


<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Copyright"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Copyright">[docs]</a><span class="k">class</span> <span class="nc">Copyright</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">injBlock</span>  <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Copyright.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Copyright.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)])</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">holder</span> <span class="o">=</span> <span class="s2">&quot;/ &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;holder&quot;</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Copyright.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Copyright.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**Copyright** </span><span class="si">%(year)s</span><span class="s2"> : </span><span class="si">%(holder)s</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Trademark"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Trademark">[docs]</a><span class="k">class</span> <span class="nc">Trademark</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">trademark</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;®&quot;</span>

<div class="viewcode-block" id="Trademark.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Trademark.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">trademark</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Code"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Code">[docs]</a><span class="k">class</span> <span class="nc">Code</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">breakFlag</span>  <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Code.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Code.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="c1"># ignore injected rst-literals</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rstInjection&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">True</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Computeroutput"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Computeroutput">[docs]</a><span class="k">class</span> <span class="nc">Computeroutput</span><span class="p">(</span><span class="n">Code</span><span class="p">):</span>   <span class="k">pass</span></div>
<span class="c1"># ------------------------------------------------------------------------------</span>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="LiteralBlock"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.LiteralBlock">[docs]</a><span class="k">class</span> <span class="nc">LiteralBlock</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">breakFlag</span>  <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rstBlock</span>   <span class="o">=</span> <span class="s2">&quot;    &quot;</span>
    <span class="n">injBlock</span>   <span class="o">=</span> <span class="kc">True</span>
    <span class="n">language</span>   <span class="o">=</span> <span class="s2">&quot;guess&quot;</span>
    <span class="n">rstMarkup</span>  <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">::</span><span class="se">\n\n</span><span class="si">%(literal)s</span><span class="se">\n\n</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="LiteralBlock.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.LiteralBlock.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span>
        <span class="c1"># FIXME: pass &quot;*&quot; as &amp;#x22C6;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;⋆&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;#x22C6;&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>  <span class="c1"># comes from unnecessary ``&lt;![CDATA[ ...`` usages</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">literal</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rstBlock</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="LiteralBlock.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.LiteralBlock.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">ID</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstAnchor</span>
        <span class="n">rst</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstMarkup</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Literallayout"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Literallayout">[docs]</a><span class="k">class</span> <span class="nc">Literallayout</span><span class="p">(</span><span class="n">LiteralBlock</span><span class="p">):</span>    <span class="k">pass</span></div>
<div class="viewcode-block" id="Screen"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Screen">[docs]</a><span class="k">class</span> <span class="nc">Screen</span><span class="p">(</span><span class="n">LiteralBlock</span><span class="p">):</span>           <span class="k">pass</span></div>
<span class="c1"># ------------------------------------------------------------------------------</span>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Programlisting"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Programlisting">[docs]</a><span class="k">class</span> <span class="nc">Programlisting</span><span class="p">(</span><span class="n">LiteralBlock</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="c1"># FIXME: einige &lt;programlisting&gt;&#39;s sind ganze Dateien, sprich das</span>
    <span class="c1"># root-Element, das kann aber nicht so einfach ausgetauscht werden.</span>

    <span class="n">language</span>   <span class="o">=</span> <span class="s2">&quot;c&quot;</span>
    <span class="n">rstMarkup</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">.. code-block:: </span><span class="si">%(language)s</span><span class="s2"></span>

<span class="si">%(literal)s</span><span class="se">\n\n\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="c1"># pandocs eats some trailing newlines</span>

<div class="viewcode-block" id="Programlisting.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Programlisting.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="c1"># ignore injected rst-literals</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rstInjection&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Funcsynopsisinfo"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Funcsynopsisinfo">[docs]</a><span class="k">class</span> <span class="nc">Funcsynopsisinfo</span><span class="p">(</span><span class="n">Programlisting</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="Synopsis"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Synopsis">[docs]</a><span class="k">class</span> <span class="nc">Synopsis</span><span class="p">(</span><span class="n">Programlisting</span><span class="p">):</span> <span class="k">pass</span></div>
<span class="c1"># ------------------------------------------------------------------------------</span>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Funcprototype"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Funcprototype">[docs]</a><span class="k">class</span> <span class="nc">Funcprototype</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">injBlock</span>   <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Funcprototype.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Funcprototype.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">funcdef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;funcdef&quot;</span><span class="p">))</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">paramdef</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;paramdef&quot;</span><span class="p">):</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">paramdef</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;⋆&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Funcprototype.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Funcprototype.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. c:function::&quot;</span>
        <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ctx</span><span class="o">.</span><span class="n">funcdef</span>
        <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot;( &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; )&quot;</span>
        <span class="k">return</span> <span class="n">rst</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Function"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Function">[docs]</a><span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="Function.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Function.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">func_call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">func_call</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">):</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">func_call</span> <span class="o">+=</span> <span class="s2">&quot;()&quot;</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Function.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Function.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;:c:func:`</span><span class="si">%(func_call)s</span><span class="s2">`&quot;</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Structname"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Structname">[docs]</a><span class="k">class</span> <span class="nc">Structname</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="Structname.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Structname.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">struct_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">struct_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;struct&quot;</span><span class="p">):</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">struct_name</span> <span class="o">=</span> <span class="s2">&quot;struct &quot;</span> <span class="o">+</span> <span class="n">ctx</span><span class="o">.</span><span class="n">struct_name</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Structname.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Structname.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;:c:type:`</span><span class="si">%(struct_name)s</span><span class="s2">`&quot;</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>

<div class="viewcode-block" id="Structfield"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Structfield">[docs]</a><span class="k">class</span> <span class="nc">Structfield</span><span class="p">(</span><span class="n">Constant</span><span class="p">):</span>   <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Mediaobject"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Mediaobject">[docs]</a><span class="k">class</span> <span class="nc">Mediaobject</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">align</span>    <span class="o">=</span> <span class="s2">&quot;center&quot;</span>

<div class="viewcode-block" id="Mediaobject.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Mediaobject.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">img_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">align</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span>
        <span class="k">for</span> <span class="n">imagedata</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//imagedata&quot;</span><span class="p">):</span>
            <span class="n">img_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FSPath</span><span class="p">(</span><span class="n">imagedata</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fileref&quot;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">align</span><span class="p">:</span>
                <span class="n">align</span> <span class="o">=</span> <span class="n">imagedata</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;align&quot;</span><span class="p">)</span>

        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">img_files</span> <span class="o">=</span> <span class="n">img_files</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">align</span>     <span class="o">=</span> <span class="n">align</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">glob</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">img_files</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">glob</span>  <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="n">img_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">suffix</span><span class="p">(</span><span class="s2">&quot;.*&quot;</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">text</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="o">*</span><span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//textobject&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ctx</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Figure"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Figure">[docs]</a><span class="k">class</span> <span class="nc">Figure</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">breakFlag</span>  <span class="o">=</span> <span class="kc">True</span>
    <span class="n">injBlock</span>   <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rstBlock</span>   <span class="o">=</span> <span class="s2">&quot;    &quot;</span>
    <span class="n">rstMarkup</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">.. figure::  </span><span class="si">%(glob)s</span><span class="s2"></span>
<span class="s2">    :alt:    </span><span class="si">%(alt)s</span><span class="s2"></span>
<span class="s2">    :align:  </span><span class="si">%(align)s</span><span class="s2"></span>

<span class="si">%(title)s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Figure.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Figure.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">Mediaobject</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="s2">&quot; / &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">BASENAME</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>  <span class="n">ctx</span><span class="o">.</span><span class="n">img_files</span><span class="p">])</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFormatedTitle</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Figure.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Figure.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="c1"># This implementation treats the time only figures with imagedata in.</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//imagedata&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">ID</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstAnchor</span>
        <span class="n">rst</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstMarkup</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rstBlock</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%(text)s</span><span class="s2">&quot;</span>
        <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="c1"># pandocs eats some trailing newlines</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Informalfigure"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Informalfigure">[docs]</a><span class="k">class</span> <span class="nc">Informalfigure</span><span class="p">(</span><span class="n">Figure</span><span class="p">):</span> <span class="k">pass</span></div>
<span class="c1"># ------------------------------------------------------------------------------</span>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Table"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Table">[docs]</a><span class="k">class</span> <span class="nc">Table</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="c1"># pandoc doesn&#39;t render tables title and anchors well</span>

    <span class="n">injBlock</span>  <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rstBlock</span>  <span class="o">=</span> <span class="s2">&quot;    &quot;</span>
    <span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">tableStartMark</span> <span class="o">=</span> <span class="s2">&quot;-- table start markup --&quot;</span>
    <span class="n">tableEndMark</span>   <span class="o">=</span> <span class="s2">&quot;-- table end markup --&quot;</span>

    <span class="n">rstPreText</span>  <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">.. table::</span><span class="si">%(title)s</span><span class="s2"></span>

<span class="si">%(tableStartMark)s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="n">rstPostText</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%(tableEndMark)s</span><span class="se">\n</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="Table.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Table.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;tbody/tr&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insertAsRawHTML</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;pgwide&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_tgroup</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Table.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Table.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">tableStartMark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tableStartMark</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">tableEndMark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tableEndMark</span>
        <span class="n">title_node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">title</span>  <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">title_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">title_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Table.preText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Table.preText">[docs]</a>    <span class="k">def</span> <span class="nf">preText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">ID</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstAnchor</span>
        <span class="n">rst</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstPreText</span>
        <span class="c1"># drop no more needed child nodes!</span>
        <span class="n">title_node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropNode</span><span class="p">(</span><span class="n">title_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Table.postText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Table.postText">[docs]</a>    <span class="k">def</span> <span class="nf">postText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstPostText</span> <span class="o">%</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Table.assert_tgroup"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Table.assert_tgroup">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">assert_tgroup</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># To render the rst output well, pandoc requires a tgroup with col</span>
        <span class="c1"># definitions.</span>
        <span class="n">tgroup</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;tgroup&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tgroup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tgroup</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">makeelement</span><span class="p">(</span><span class="s2">&quot;tgroup&quot;</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tgroup</span><span class="p">)</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;tbody/row&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;./entry&quot;</span><span class="p">))</span>
            <span class="n">tgroup</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cols&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cols</span><span class="p">))</span>
            <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cols</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="p">(</span><span class="n">cols</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">w</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">colspec</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">makeelement</span><span class="p">(</span><span class="s2">&quot;colspec&quot;</span><span class="p">)</span>
                <span class="n">colspec</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;colname&quot;</span><span class="p">,</span> <span class="s2">&quot;c</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
                <span class="n">colspec</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;colwidth&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">*&quot;</span> <span class="o">%</span> <span class="n">w</span><span class="p">)</span>
                <span class="n">tgroup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colspec</span><span class="p">)</span>
            <span class="n">tbody</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;tbody&quot;</span><span class="p">)</span>
            <span class="n">tgroup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tbody</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colspec_s</span> <span class="o">=</span> <span class="n">tgroup</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;colspec&quot;</span><span class="p">)</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colspec_s</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">colspec</span> <span class="ow">in</span> <span class="n">colspec_s</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">colspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;colwidth&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cols</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="p">(</span><span class="n">cols</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
                        <span class="n">w</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">colspec</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;colwidth&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">*&quot;</span> <span class="o">%</span> <span class="n">w</span><span class="p">)</span></div></div>



<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Informaltable"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Informaltable">[docs]</a><span class="k">class</span> <span class="nc">Informaltable</span><span class="p">(</span><span class="n">Table</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">injBlock</span>  <span class="o">=</span> <span class="kc">True</span>
    <span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Informaltable within media DocBook are often used to draw a border around</span>
    <span class="c1"># a paragraph. This breaks the separation of *presentation from content*.</span>

<div class="viewcode-block" id="Informaltable.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Informaltable.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">tgroup</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;tgroup&quot;</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tgroup</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cols&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropUselessTable</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Informaltable.dropUselessTable"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Informaltable.dropUselessTable">[docs]</a>    <span class="k">def</span> <span class="nf">dropUselessTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">strip_tags</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;tgroup&quot;</span><span class="p">,</span> <span class="s2">&quot;tbody&quot;</span><span class="p">,</span> <span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="p">)</span> <span class="c1"># pylint: disable=E1101</span>
        <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span> <span class="n">moveID</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replaceNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">rstPrefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstBlock</span><span class="p">)</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Tgroup"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Tgroup">[docs]</a><span class="k">class</span> <span class="nc">Tgroup</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">injBlock</span>  <span class="o">=</span> <span class="kc">True</span>
    <span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># There is a entity within the media_api.xml:</span>
    <span class="c1">#</span>
    <span class="c1"># &lt;!ENTITY cs-def  &quot;&lt;colspec colname=&#39;c1&#39; colwidth=&#39;3*&#39; /&gt; \</span>
    <span class="c1">#                  &lt;colspec colname=&#39;c2&#39; colwidth=&#39;1*&#39; /&gt;  \</span>
    <span class="c1">#                  &lt;colspec colname=&#39;c3&#39; colwidth=&#39;4*&#39; /&gt; \</span>
    <span class="c1">#                  &lt;spanspec spanname=&#39;hspan&#39; namest=&#39;c1&#39; nameend=&#39;c3&#39; /&gt;&quot;&gt;</span>
    <span class="c1">#</span>
    <span class="c1"># This cs-def entity defines 3 columns, but it is partial used in tables</span>
    <span class="c1"># with 2 columns, which is mistakeable /  e.g.: frontend_legacy_api.p1_xml the</span>
    <span class="c1">#</span>
    <span class="c1"># &lt;table pgwide=&quot;1&quot; frame=&quot;none&quot; id=&quot;fe-bandwidth&quot;&gt;</span>
    <span class="c1">#     &lt;title&gt;enum fe_bandwidth&lt;/title&gt;</span>
    <span class="c1">#     &lt;tgroup cols=&quot;2&quot;&gt;   &lt;!-- TWO cols   !!! --&gt;</span>
    <span class="c1">#         &amp;cs-def;        &lt;!-- THREE cols !!! --&gt;</span>


<div class="viewcode-block" id="Tgroup.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Tgroup.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repairTableDef</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tgroup.repairTableDef"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Tgroup.repairTableDef">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">repairTableDef</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0613</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cols&quot;</span><span class="p">))</span>
        <span class="n">colspec_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;colspec&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cols</span> <span class="o">!=</span> <span class="n">colspec_cols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">colspec</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="s2">&quot;colspec&quot;</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">colspec</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">spanspec</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="s2">&quot;spanspec&quot;</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">spanspec</span><span class="p">)</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;tbody/row&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;./entry&quot;</span><span class="p">))</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cols&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cols</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">colspec</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">makeelement</span><span class="p">(</span><span class="s2">&quot;colspec&quot;</span><span class="p">)</span>
                <span class="n">colspec</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;colname&quot;</span><span class="p">,</span> <span class="s2">&quot;c</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
                <span class="n">colspec</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;colwidth&quot;</span><span class="p">,</span> <span class="s2">&quot;1*&quot;</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">colspec</span><span class="p">)</span></div></div>


<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Entrytbl"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Entrytbl">[docs]</a><span class="k">class</span> <span class="nc">Entrytbl</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="c1"># flatten these braindead inner-tables</span>

    <span class="n">breakFlag</span>  <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Entrytbl.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Entrytbl.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>

        <span class="n">newEntry</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">makeelement</span><span class="p">(</span><span class="s2">&quot;entry&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subEntry</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//entry&quot;</span><span class="p">):</span>
            <span class="n">para</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyNode</span><span class="p">(</span><span class="n">subEntry</span><span class="p">,</span> <span class="s2">&quot;para&quot;</span><span class="p">,</span> <span class="n">moveID</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">newEntry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="p">)</span>
        <span class="c1">#SDK.CONSOLE()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replaceNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">newEntry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">newEntry</span><span class="p">,</span> <span class="n">rstPrefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstBlock</span><span class="p">)</span></div></div>




<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Authorgroup"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Authorgroup">[docs]</a><span class="k">class</span> <span class="nc">Authorgroup</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">breakFlag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">injBlock</span>  <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Authorgroup.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Authorgroup.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># pylint: disable=R0204</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">authorlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;author&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;corpauthor&quot;</span><span class="p">)):</span>
            <span class="n">trademark</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">author</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;trademark&quot;</span><span class="p">):</span>
                <span class="n">trademark</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span> <span class="o">+</span> <span class="n">Trademark</span><span class="o">.</span><span class="n">trademark</span><span class="p">)</span>
            <span class="n">trademark</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trademark</span><span class="p">)</span>
            <span class="n">corpauthor</span> <span class="o">=</span> <span class="n">trademark</span>
            <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;corpauthor&quot;</span><span class="p">:</span>
                <span class="n">corpauthor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">author</span><span class="p">)</span> <span class="o">+</span> <span class="n">trademark</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span>
                <span class="n">firstname</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="o">*</span><span class="n">author</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;firstname&quot;</span><span class="p">))</span>   <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                <span class="p">,</span> <span class="n">surname</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="o">*</span><span class="n">author</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;surname&quot;</span><span class="p">))</span>     <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                <span class="p">,</span> <span class="n">othername</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="o">*</span><span class="n">author</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;othername&quot;</span><span class="p">))</span>   <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                <span class="p">,</span> <span class="n">affiliation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="o">*</span><span class="n">author</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;affiliation&quot;</span><span class="p">))</span>
                <span class="p">,</span> <span class="n">corpauthor</span>  <span class="o">=</span> <span class="n">corpauthor</span>
                <span class="p">,</span> <span class="n">contrib</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="o">*</span><span class="n">author</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;contrib&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">authorlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Authorgroup.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Authorgroup.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">authorlist</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">authorlist</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">:author:   &quot;</span>
                <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">surname</span><span class="p">:</span>      <span class="n">r</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%(surname)s</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">firstname</span><span class="p">:</span>    <span class="n">r</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%(firstname)s</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">othername</span><span class="p">:</span>    <span class="n">r</span> <span class="o">+=</span> <span class="s2">&quot; (*</span><span class="si">%(othername)s</span><span class="s2">*)&quot;</span>
                <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">corpauthor</span><span class="p">:</span>   <span class="n">r</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%(corpauthor)s</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">affiliation</span><span class="p">:</span>  <span class="n">r</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">:address:   </span><span class="si">%(affiliation)s</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">contrib</span><span class="p">:</span>      <span class="n">r</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">:contrib:   </span><span class="si">%(contrib)s</span><span class="s2">&quot;</span>
                <span class="n">rst</span> <span class="o">+=</span> <span class="n">r</span> <span class="o">%</span> <span class="n">author</span>
                <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>



<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Revremark"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Revremark">[docs]</a><span class="k">class</span> <span class="nc">Revremark</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span> <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;para&quot;</span></div>
<div class="viewcode-block" id="Revision"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Revision">[docs]</a><span class="k">class</span> <span class="nc">Revision</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">injBlock</span>  <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rstBlock</span>  <span class="o">=</span> <span class="s2">&quot;    &quot;</span>

<div class="viewcode-block" id="Revision.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Revision.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">walkChilds</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstBlock</span><span class="p">)</span></div>

<div class="viewcode-block" id="Revision.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Revision.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">revnumber</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="o">*</span><span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;revnumber&quot;</span><span class="p">))</span>   <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">date</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="o">*</span><span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">))</span>        <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">authorinitials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="o">*</span><span class="n">node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;authorinitials&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Revision.preText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Revision.preText">[docs]</a>    <span class="k">def</span> <span class="nf">preText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">:revision: </span><span class="si">%(revnumber)s</span><span class="s2"> / </span><span class="si">%(date)s</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">authorinitials</span><span class="p">:</span>
            <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot; (*</span><span class="si">%(authorinitials)s</span><span class="s2">*)&quot;</span>
        <span class="c1">#rst += &quot;\n:remark:   %(revremark)s&quot;</span>
        <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span>

        <span class="c1"># drop no more needed child nodes!</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;revnumber&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span> <span class="p">]:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dropNode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>


<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Biblioentry"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Biblioentry">[docs]</a><span class="k">class</span> <span class="nc">Biblioentry</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="c1"># DocBooks biblioentrie&#39;s are usually misapplied, e.g.::</span>
    <span class="c1">#</span>
    <span class="c1">#     &lt;biblioentry id=&quot;cea608&quot;&gt;</span>
    <span class="c1">#       &lt;abbrev&gt;CEA 608-E&lt;/abbrev&gt;</span>
    <span class="c1">#       &lt;authorgroup&gt;</span>
    <span class="c1"># 	&lt;corpauthor&gt;Consumer Electronics Association ...&lt;/corpauthor&gt;</span>
    <span class="c1">#       &lt;/authorgroup&gt;</span>
    <span class="c1">#       &lt;title&gt;CEA-608-E R-2014 &quot;Line 21 Data Services&quot;&lt;/title&gt;</span>
    <span class="c1">#     &lt;/biblioentry&gt;</span>
    <span class="c1">#</span>
    <span class="c1"># The abbrev-Tag contains whitespaces which doesn&#39;t fits to common citation</span>
    <span class="c1"># reference conzept.  Within old DocBook version they are refered by ID</span>
    <span class="c1"># (``&lt;xref linkend=&quot;cea608&quot;/&gt;``) and note by ``&lt;citation&gt;CEA608E&lt;/citation&gt;``.</span>
    <span class="c1">#</span>
    <span class="c1"># To solve this problem in multipart documents, more work is needed. This</span>
    <span class="c1"># here is just POV implementation.</span>

    <span class="n">injBlock</span>  <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rstBlock</span>  <span class="o">=</span> <span class="s2">&quot;    &quot;</span>

<div class="viewcode-block" id="Biblioentry.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Biblioentry.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">abbrev</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;abbrev&quot;</span><span class="p">))</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">title</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">subtitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripedText</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;subtitle&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="Biblioentry.preText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Biblioentry.preText">[docs]</a>    <span class="k">def</span> <span class="nf">preText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">ID</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstAnchor</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">abbrev</span><span class="p">:</span>       <span class="n">rst</span> <span class="o">+=</span> <span class="n">Section</span><span class="p">()</span><span class="o">.</span><span class="n">rstTitle</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">abbrev</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>        <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">:title:     </span><span class="si">%(title)s</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">subtitle</span><span class="p">:</span>     <span class="n">rst</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">:subtitle:  </span><span class="si">%(subtitle)s</span><span class="s2">&quot;</span>

        <span class="c1"># drop no more needed child nodes!</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;abbrev&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;subtitle&quot;</span> <span class="p">]:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dropNode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span></div></div>

<span class="c1">## ==============================================================================</span>
<span class="c1">#class Example(Tag):</span>
<span class="c1">## ==============================================================================</span>

<div class="viewcode-block" id="Informalexample"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.Informalexample">[docs]</a><span class="k">class</span> <span class="nc">Informalexample</span><span class="p">(</span><span class="n">StructureTag</span><span class="p">):</span>     <span class="n">replaceTag</span> <span class="o">=</span> <span class="s2">&quot;para&quot;</span></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="ReSTTemplate"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.ReSTTemplate">[docs]</a><span class="k">class</span> <span class="nc">ReSTTemplate</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="c1"># !E&lt;filename&gt; is replaced by the documentation, in &lt;filename&gt;, for</span>
    <span class="c1"># functions that are exported using EXPORT_SYMBOL: the function list is</span>
    <span class="c1"># collected from files listed in Documentation/DocBook/Makefile.</span>

    <span class="c1"># !I&lt;filename&gt; is replaced by the documentation for functions that are</span>
    <span class="c1"># _not_ exported using EXPORT_SYMBOL.</span>

    <span class="c1"># !D&lt;filename&gt; is used to name additional files to search for functions</span>
    <span class="c1"># exported using EXPORT_SYMBOL.   NOT USED ANYMORE!!!!!!!!!!!!!</span>

    <span class="c1"># !F&lt;filename&gt; &lt;function [functions...]&gt; is replaced by the</span>
    <span class="c1"># documentation, in &lt;filename&gt;, for the functions listed.</span>

    <span class="c1"># !P&lt;filename&gt; &lt;section title&gt; is replaced by the contents of the DOC:</span>
    <span class="c1"># section titled &lt;section title&gt; from &lt;filename&gt;.</span>
    <span class="c1"># Spaces are allowed in &lt;section title&gt;; do not quote the &lt;section title&gt;.</span>

    <span class="c1"># !C&lt;filename&gt; is replaced by nothing, but makes the tools check that</span>
    <span class="c1"># all DOC: sections and documented functions, symbols, etc. are used.</span>
    <span class="c1"># This makes sense to use when you use !F/!P only and want to verify</span>

    <span class="n">tag</span> <span class="o">=</span> <span class="n">XMLTag</span><span class="o">.</span><span class="n">rstTemplate_tag</span>
    <span class="n">injBlock</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rstMarkup</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">.. kernel-doc:: </span><span class="si">%(fname)s</span><span class="s2"></span>
<span class="si">%(options)s</span><span class="s2"></span>

<span class="s2">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ReSTTemplate.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.ReSTTemplate.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">op</span>      <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;op&quot;</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">fname</span>   <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fname&quot;</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">args</span>    <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="s2">&quot;    :man-sect: 9</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">options</span> <span class="o">+=</span> <span class="s2">&quot;    :export:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">options</span> <span class="o">+=</span> <span class="s2">&quot;    :internal:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">options</span> <span class="o">+=</span> <span class="s2">&quot;    :functions: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ctx</span><span class="o">.</span><span class="n">args</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">options</span> <span class="o">+=</span> <span class="s2">&quot;    :doc: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ctx</span><span class="o">.</span><span class="n">args</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="ReSTTemplate.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.ReSTTemplate.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstMarkup</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]:</span>
            <span class="n">rst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">.. NOT SUPPORTED: &#39;!</span><span class="si">%(op)s%(fname)s</span><span class="s2"> </span><span class="si">%(args)s</span><span class="s2">&#39;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="n">rst</span> <span class="o">%</span> <span class="n">ctx</span>
        <span class="k">return</span> <span class="n">retVal</span></div></div>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="ReSTInclude"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.ReSTInclude">[docs]</a><span class="k">class</span> <span class="nc">ReSTInclude</span><span class="p">(</span><span class="n">XMLTag</span><span class="p">):</span>
<span class="c1"># ==============================================================================</span>

    <span class="n">tag</span> <span class="o">=</span> <span class="n">XMLTag</span><span class="o">.</span><span class="n">rstInclude_tag</span>
    <span class="n">breakFlag</span>  <span class="o">=</span> <span class="kc">False</span>
    <span class="n">injBlock</span>   <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rstBlock</span>   <span class="o">=</span> <span class="s2">&quot;    &quot;</span>
    <span class="n">rstMarkup</span>  <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">.. toctree::</span>
<span class="s2">    :maxdepth: 1</span>

<span class="si">%(entries)s</span><span class="s2"></span>


<span class="s2">&quot;&quot;&quot;</span>
<div class="viewcode-block" id="ReSTInclude.applyFilter"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.ReSTInclude.applyFilter">[docs]</a>    <span class="k">def</span> <span class="nf">applyFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">parseIncludes</span><span class="p">:</span>
            <span class="n">folder</span>   <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
            <span class="n">thisFile</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">fname</span>
            <span class="n">inclFile</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="n">FSPath</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fname&quot;</span><span class="p">))</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;INFO: &lt;rstInclude fname=&#39;</span><span class="si">%s</span><span class="s2">&#39;&gt; will not be parsed!&quot;</span> <span class="o">%</span> <span class="n">inclFile</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">thisFile</span><span class="o">.</span><span class="n">DIRNAME</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder</span>    <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
            <span class="n">inFile</span>    <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fname&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">suffix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">fname</span><span class="o">.</span><span class="n">SUFFIX</span><span class="p">)</span>
            <span class="n">outFile</span>   <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">suffix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">outFile</span><span class="o">.</span><span class="n">SUFFIX</span><span class="p">)</span>
            <span class="n">xmlFilter</span> <span class="o">=</span> <span class="n">XMLTag</span><span class="p">()</span>
            <span class="n">xmlFilter</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="p">)</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;parsing: &lt;rstInclude fname=&#39;</span><span class="si">%s</span><span class="s2">&#39;&gt;&quot;</span> <span class="o">%</span> <span class="n">inFile</span><span class="p">)</span>
            <span class="n">filterXML</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">inFile</span><span class="p">,</span> <span class="n">outFile</span><span class="p">,</span> <span class="n">xmlFilter</span> <span class="o">=</span> <span class="n">xmlFilter</span><span class="p">,</span> <span class="n">parseIncludes</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>

        <span class="c1"># insert rst toctree directive</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">)</span></div>


<div class="viewcode-block" id="ReSTInclude.get_toctree_entry"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.ReSTInclude.get_toctree_entry">[docs]</a>    <span class="k">def</span> <span class="nf">get_toctree_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">folder</span>   <span class="o">=</span> <span class="n">FSPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">thisFile</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseData</span><span class="o">.</span><span class="n">fname</span>
        <span class="n">inclFile</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">/</span> <span class="n">FSPath</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fname&quot;</span><span class="p">))</span>
        <span class="n">toctree</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstBlock</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inclFile</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">thisFile</span><span class="o">.</span><span class="n">DIRNAME</span><span class="p">)</span><span class="o">.</span><span class="n">SKIPSUFFIX</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">toctree</span></div>

<div class="viewcode-block" id="ReSTInclude.getContext"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.ReSTInclude.getContext">[docs]</a>    <span class="k">def</span> <span class="nf">getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nextNode</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">nextNode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
               <span class="ow">and</span> <span class="n">nextNode</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstInclude_tag</span>
               <span class="ow">and</span> <span class="n">nextNode</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ignoreToctree&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_toctree_entry</span><span class="p">(</span><span class="n">nextNode</span><span class="p">))</span>
            <span class="n">nextNode</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;ignoreToctree&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">)</span>
            <span class="n">nextNode</span> <span class="o">=</span> <span class="n">nextNode</span><span class="o">.</span><span class="n">getnext</span><span class="p">()</span>
            <span class="k">while</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nextNode</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">_Comment</span><span class="p">):</span> <span class="c1"># pylint: disable=E1101, W0212</span>
                <span class="n">nextNode</span> <span class="o">=</span> <span class="n">nextNode</span><span class="o">.</span><span class="n">getnext</span><span class="p">()</span>

        <span class="n">ctx</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">entries</span><span class="p">)</span>  <span class="c1"># pylint: disable=R0204</span>
        <span class="k">return</span> <span class="n">ctx</span></div>

<div class="viewcode-block" id="ReSTInclude.replaceText"><a class="viewcode-back" href="../../dbxml2rst/dbxml2rst.nodes.html#dbxml2rst.nodes.ReSTInclude.replaceText">[docs]</a>    <span class="k">def</span> <span class="nf">replaceText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">rstPrefix</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rstMarkup</span> <span class="o">%</span> <span class="n">ctx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div></div>

</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 Markus Heiser.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'20160727',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>